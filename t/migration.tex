%pdflatex-../thesis.tex
% vim:spell spelllang=en_us

% Porovnejte metody přenosu virtuálních strojů v prostředí distribuovaného datového centra. Navrhněte metodiku hodnocení průběhu přenosu a porovnejte vhodnost různých způsobů ukládání dat a překryvných sítí. Zaměřte se zejména na jejich vhodnost pro přenos virtuálních strojů.


Virtualization is enabling technology for cloud computing and it provides separation of running operating system (\Ac{VM}) from physical machine. Software can be fully decoupled from hardware and located anywhere in datacenter or even migrated between datacenters. 

Virtual machines (\Ac{VM}) are running on physical servers called nodes or hypervisors. Migration is process of shifting virtual machine from source hypervisor to destination hypervisor. Migration should be undetectable for virtual machine since software running inside must stay running and remain intact. It can be theoretically possible to detect ongoing migration but detection will be based performance changes so it should not be possible to detect hypervisor \Ac{VM} is running on.

% parameters - downtime, total migration time, requrements

There are two different types of migration - cold and live. Both types migrate virtual machine from source hypervisor to destination, but difference is in migration parameters and method for solving boundary value problem.

Virtual machine can be abstracted as a group of mutually cooperating resources. There resource are required for virtual machine operation and thus all of the resource need to be transfered to destination hypervisor during migration. Resources can be
\begin{itemize}
	\item \Ac{VM} parameters (e.g. number of \Ac{CPU}, allocated memory, virtual \Ac{NIC})
	\item image of system disk (used to boot operating system)
	\item additional images (e.g. CD-ROM images, encrypted block devices)
	\item other interfaces (e.g. physical \Ac{USB} devices)
	\item virtual network
	\item memory
\end{itemize}
Migrating all of these resource may not be trivial because different migration approach must be used. Migration of \Ac{VM} parameters is trivial because it is just very small plain text, \Ac{XML} or \Ac{JSON} file.

\section{Storage}
% images
Image of system disk, as well as additional images, need to be available for destination hypervisor. Easiest solution is to transfer images during migration but it can take long time, consume all bandwidth available and thus significantly affects service performance as well as other tenant's traffic. Workaround based on dynamic rate-limiting is proposed in \cite{live-migration-of-vms}.

% shared storage
More advanced solution is using shared storage. This storage is shared between all of hypervisor and thus all images are immediately available. Building of shared storage is, however, not easy task because it is necessary to fulfill requirements listed in \ref{par:storage-network}. Situation is even more complicated for distributed datacenter where hypervisor may be distant in geographical and network manner. Critical parameter for storage in distributed datacenter is round-trip time because synchronous write operations on storage need to be acknowledged. It is possible to use storage in asynchronous mode but it is dangerous because data corruption may occur and single control node is needed. Single control node is single point of failure as well. 

I think that migration between datacenter (i.e. in distributed datacenter) should combine different technologies. It does not make sense to store all images in inter-datacenter shared storage because there is significant performance penalty caused by \Ac{IO} operations transfered over network. Migration can be realized in two steps. First image can be migrated from inter-datacenter to intra-datacenter storage and then whole virtual machine migration can be carried-out.


\section{Network}
% network


\section{Cold migration}
Procedure of cold migration is simpler than live migration. Virtual machine must be in power-off state before migration, so disadvantage of this method is obvious because all running processes need to be terminated and complete operating system shutdown is needed.

Service downtime for cold migration is much longer compared to live migration, because it is required to shutdown \Ac{VM} and virtual machine is not running during migration. However complete virtual machine shutdown can be beneficial for virtual machines with intensive memory writes because it significantly decreases total migration time. 

Cold migration is suitable for virtual machines which are part of cluster with working failover and shutdown of single virtual machine is not going to cause service outage. Another appropriate case is migration without shared storage and thus image must be transfered during migration, however disk transfer may be beneficial if it is necessary to change datastore or even virtualization technology.


\section{Live migration}
Migration can be performed \Uv{live} almost without service disruption. According to measurements provided in \cite{live-migration-of-vms} can be downtime as low as $60~\Jed{ms}$ but it depends on application and infrastructure parameters.



